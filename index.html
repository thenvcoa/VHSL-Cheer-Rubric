
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>VHSL Cheer Coaches Rubric Submission</title>

<!-- ========================STYLE COMMANDS======================== -->
<style>
  body { font-family: Arial, sans-serif; margin: 30px; background: #fafafa; }
  h1 { color: #2F317D; }
  label { display: block; margin-top: 15px; font-weight: bold; }
  input, select, textarea { width: 90%; max-width: 600px; padding: 8px; margin-top: 5px; }
  button { margin-top: 25px; padding: 10px 16px; background: #2F317D; color: white; border: none; border-radius: 5px; cursor: pointer; }
  button:hover { background: #c02025; }
/* Center the entire wrapper, not the image */
.wrapper {
    width: fit-content;     /* wrapper becomes exactly the width of the image */
    margin-left: auto;
    margin-right: auto;     /* centers wrapper in the cell */
    position: relative;     /* needed for hotspots */
	margin-bottom: 40px;   /*  add spacing here */
}

/* DO NOT modify the image at all */
.wrapper img {
    display: block;         /* block is safe here because wrapper now fits exact width */
}
/* Table-like layout */
.stunt-table {
  display: flex;
  flex-direction: column;
  width: 100%;
}

.stuntRow {
  display: flex;
  border: 1px solid #ccc;
  background: #fff;
  margin-bottom: 2px;
  cursor: grab;
}

.stuntRow.dragging {
  opacity: 0.5;
}

.cell {
  flex: 1;
  padding: 8px;
  text-align: center;
}

/* Optional: make drag handle smaller */
.drag-handle {
  flex: 0 0 30px;
}


  #StuntRubricImage { width: 90%; max-width: 950px; display: block; }
  #PyramidRubricImage { width: 90%; max-width: 950px; display: block; }
  .highlight { position: absolute; border: 2px solid transparent; background-color: transparent; pointer-events: none; display: none; }
  .twisting { border-color: rgba(255,0,0,0.8); background-color: rgba(255,0,0,0.25); }
  .coed     { border-color: rgba(0,0,255,0.8); background-color: rgba(0,0,255,0.25); }
  .release  { border-color: rgba(0,180,0,0.8); background-color: rgba(0,180,0,0.25); }
  .inversion{ border-color: rgba(180,0,180,0.8); background-color: rgba(180,0,180,0.25); }
  .toss     { border-color: rgba(255,120,0,0.8); background-color: rgba(255,120,0,0.25); }
  #output { margin-top: 20px; white-space: pre-wrap; background: #f7f7f7; padding: 10px; border-radius: 5px; max-width: 825px; }
  #outputp { margin-top: 20px; white-space: pre-wrap; background: #f7f7f7; padding: 10px; border-radius: 5px; max-width: 825px; } 
  table { width: 70%; max-width: 950px; border-collapse: collapse; margin-top: 10px; }
  th, td { padding: 6px 10px; text-align: left; border-bottom: 1px solid #ccc; }
  th { background: #f0f0f0; }
  .drag-handle { cursor: grab; font-size: 18px; }
  .delete-btn { cursor: pointer; color: #d00; font-size: 18px; text-align: center; }
  .hotpink-underline {  color: #c02025;  text-decoration: underline;  }
  .icon {  font-size: 24px;       vertical-align: middle;   }
  .majority { background-color: rgba(0, 200, 0, 0.2);  }
  .non-majority {  background-color: rgba(255, 0, 0, 0.2);  }
 hs { border: none; 	height: 2px; 	background-color: #c02025; 	margin: 15px 0; } 
 hr { border: none; 	height: 2px; 	background-color: #c02025; 	margin: 30px 0; }
  .center-text { text-align: center;}
  a { color: #2F317D;  text-decoration: underline; }
  a:hover { color: #c02025; }
  input::placeholder, textarea::placeholder {  font-style: italic; color: #CFCFCE; white-space: pre-line;}
  textarea { font-family: Arial, sans-serif;}
  .highlight-bar {    background-color: #F8DF00;  padding: 6px 6px; border-radius: 6px; display: inline-block;}
.jumphighlight.selected {   outline: 3px solid red;   background-color: rgba(255,0,0,0.15);}
.jumphighlight {    position: absolute;    cursor: pointer;}
.tumblinghighlight.selected {    outline: 3px solid red; background-color: rgba(255,0,0,0.15);}
.tumblinghighlight {   position: absolute;   cursor: pointer;}
  #customAlert { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5);
                 display: flex; justify-content: center; align-items: center; z-index: 9999;}
  #customAlertContent {background: #fff; padding: 20px 25px; border-radius: 8px;
                       max-width: 400px; text-align: center; box-shadow: 0 4px 10px rgba(0,0,0,0.3);}
  #customAlertContent button { margin-top: 15px; padding: 8px 16px; background: #2F317D; color: white;
                               border: none; border-radius: 5px; cursor: pointer;}
  #customAlertContent button:hover {  background: #c02025;}
  #customAlertText {  white-space: pre-line;}

 
</style>
</head>
<body>

<!-- ========================START HTML VISUAL======================== -->


	<div style="text-align: center; margin-bottom: 20px;">
		<img src="vhsl_logo.png" alt="VHSL Logo" style="max-width: 250px; height: auto;">
	</div>

	<div style="text-align: center; margin-bottom: 40px;">
		<h1>VHSL Cheer Coaches Rubric Submission</h1>
	</div>

<div class="center-text">
<p>
  For additional resources, visit 
  <a href="https://www.vhsl.org/competition-cheer/" target="_blank" rel="noopener noreferrer">
    VHSL Cheer Website</a>.
</p>
</div>

<hr>

<div class="center-text">
 <p class="highlight-bar">All fields are required.</p>
</div>


  <label>School Name</label>
  <input type="text" id="schoolName">

  <label>Team Level</label>
  <select id="teamLevel">
    <option value="">--Select--</option>
    <option value="Varsity">Varsity</option>
    <option value="Junior Varsity">Junior Varsity</option>
  </select>

  <label>Head Coach First & Last Name</label>
  <input type="text" id="CoachName">
 
   <label>Head Coach Email</label>
  <input type="text" id="CoachEmail" placeholder="myname@gmail.com">

  <label>Number of Athletes Performing</label>
  <input type="number" id="numAthletes" min="1">

<!--
  <label>Competition Name/Location</label>
  <input type="text" id="competitionLocation" placeholder="e.g., Battle at the Beach @ Westside High School">
--!>


<label>Competition Location</label>
<select id="competitionLocation">
  <option value="">--Select--</option>
</select>



  <label>Competition Date</label>
  <input type="date" id="competitionDate">
  
<hr>

<div class="center-text">
  <h2>Stunt Skills Rubric</h2>
  <p><strong>Click on the rubric image to select skills.</strong></p>
</div>


	<div class="wrapper">
		<img id="StuntRubricImage" src="Stunt_Rubric.png" alt="VHSL Stunt Rubric">
		<!-- Highlight boxes -->
		<div class="highlight inversion" id="i1" style="left:62px; top:131px; width:146px; height:17px;"></div>
		<div class="highlight inversion" id="i2" style="left:62px; top:150px; width:146px; height:18px;"></div>
		<div class="highlight inversion" id="i3" style="left:62px; top:169px; width:146px; height:17px;"></div>
		<div class="highlight inversion" id="i4" style="left:209px; top:131px; width:146px; height:17px;"></div>

		<div class="highlight release" id="r1" style="left:62px; top:217px; width:146px; height:15px;"></div>
		<div class="highlight release" id="r2" style="left:62px; top:233px; width:146px; height:13px;"></div>
		<div class="highlight release" id="r3" style="left:62px; top:280px; width:146px; height:14px;"></div>

		<div class="highlight twisting" id="t1" style="left:62px; top:335px; width:146px; height:7px;"></div>
		<div class="highlight twisting" id="t2" style="left:62px; top:342px; width:146px; height:14px;"></div>
		<div class="highlight twisting" id="t3" style="left:62px; top:356px; width:146px; height:15px;"></div>

		<div class="highlight coed" id="c1" style="left:62px; top:410px; width:146px; height:14px;"></div>
		<div class="highlight coed" id="c2" style="left:62px; top:439px; width:146px; height:15px;"></div>
		<div class="highlight coed" id="c3" style="left:62px; top:455px; width:146px; height:15px;"></div>

		<div class="highlight toss" id="o1" style="left:62px; top:555px; width:146px; height:15px;"></div>
		<div class="highlight toss" id="o2" style="left:62px; top:582px; width:146px; height:21px;"></div>
		<div class="highlight toss" id="o3" style="left:62px; top:600px; width:146px; height:15px;"></div>

		<div class="highlight inversion" id="h1" style="left:140px; top:550px; width:180px; height:20px;"></div>
		<div class="highlight release" id="h2" style="left:330px; top:550px; width:180px; height:20px;"></div>
		<div class="highlight twisting" id="h3" style="left:630px; top:550px; width:180px; height:20px;"></div>
	</div>

	<p><strong>
	Enter the number of stunt groups for each skill. 
	<span class="hotpink-underline">Please list skills in order of performance.</span> 
	Drag <span class="icon">‚áÖ</span> to reorder skills or click <span class="icon">üóëÔ∏è</span> to delete skills.
	</strong></p>

	<!-- Drag & drop table -->
<div id="stuntList" class="stunt-table"></div>

	<div style="display: flex; align-items: center; gap: 10px;">
	<button onclick="runChecker()">Calculate Stunt Difficulty Range</button>
	<span style="font-style: italic; color: gray;">
		Majority skills will highlight in green and non-majority skills will highlight in red.
	</span>
	</div>

	<div id="output"></div>

<hr>

 <div class="center-text">
  <h2>Pyramid Skills Rubric</h2>
  <p><strong>Click on the rubric image to select skills.</strong></p>
</div>


	<div class="wrapper">
		<img id="PyramidRubricImage" src="Pyramid_Rubric.png" alt="VHSL Pyramid Rubric">
		<!-- Highlight boxes -->
		<div class="highlight inversion" id="n1" style="left:162px; top:110px; width:125px; height:23px;"></div>
		<div class="highlight inversion" id="n2" style="left:162px; top:134px; width:125px; height:26px;"></div>
		<div class="highlight inversion" id="n3" style="left:162px; top:191px; width:125px; height:23px;"></div>
		<div class="highlight inversion" id="n4" style="left:289px; top:110px; width:129px; height:23px;"></div>

		<div class="highlight release" id="pr1" style="left:162px; top:248px; width:125px; height:27px;"></div>
		<div class="highlight release" id="pr2" style="left:162px; top:277px; width:125px; height:28px;"></div>
		<div class="highlight release" id="pr3" style="left:289px; top:248px; width:129px; height:27px;"></div>

		<div class="highlight twisting" id="b1" style="left:162px; top:373px; width:125px; height:22px;"></div>
		<div class="highlight twisting" id="b2" style="left:162px; top:396px; width:125px; height:28px;"></div>
		<div class="highlight twisting" id="b3" style="left:289px; top:373px; width:129px; height:22px;"></div>
	</div>

	<p><strong>
	Enter the number of trick flyers for each skill. 
	<span class="hotpink-underline">Please list skills in order of performance.</span> 
	Drag <span class="icon">‚áÖ</span> to reorder skills or click <span class="icon">üóëÔ∏è</span> to delete skills.
	</strong></p>

	<!-- Drag & drop table -->
	<table id="PyramidCountsTable">
		<thead>
		<tr>
			<th style="width:30px;">‚áÖ</th>
			<th>Skill</th>
			<th>Difficulty</th>
			<th># of Trick Flyers</th>
			<th style="width:30px;">üóëÔ∏è</th>
		</tr>
		</thead>
		<tbody id="PyramidCounts"></tbody>
	</table>

	<div style="display: flex; align-items: center; gap: 10px;">
	<button onclick="runChecker2()">Calculate Pyramid Difficulty Range</button>
	<span style="font-style: italic; color: gray;">
		Majority skills will highlight in green and non-majority skills will highlight in red.
	</span>
	</div>

	<div id="outputp"></div>
  
<hr>

<div class="center-text">
  <h2>Tumbling Skills Rubric</h2>
  <p><strong>Click on the rubric image to select skills.</strong></p>
</div>

<div class="wrapper">
    <img id="TumblingRubricImage" src="Tumbling_Rubric.png" alt="Tumbling Rubric">

    <!-- Highlight boxes (clickable areas) -->
    <!-- Row 1: 0.0 ‚Äì 1.5 -->
    <div class="tumblinghighlight tumbling" id="tumbling1" 
         style="left:7px; top:100px; width:595px; height:103px;" 
         data-value="0.0 ‚Äì 1.5"></div>

    <!-- Row 2: 1.75 ‚Äì 2.75 -->
    <div class="tumblinghighlight tumbling" id="tumbling2" 
         style="left:7px; top:205px; width:595px; height:83px;" 
         data-value="1.75 ‚Äì 2.75"></div>

    <!-- Row 3: 3.00 ‚Äì 4.00 -->
    <div class="tumblinghighlight tumbling" id="tumbling3" 
         style="left:7px; top:290px; width:595px; height:67px;" 
         data-value="3.00 ‚Äì 4.00"></div>

    <!-- Row 4: 4.25 ‚Äì 4.75 -->
    <div class="tumblinghighlight tumbling" id="tumbling4" 
         style="left:7px; top:359px; width:595px; height:92px;" 
         data-value="4.25 ‚Äì 4.75"></div>

</div>

<div id="TumblingOutput" style="margin-top:15px; font-size:1.2em; font-weight:bold;">
    Tumbling Difficulty Range: None
</div>

<!--
  <label>Intended Tumbling Range</label>
  <select id="tumblingRange">
    <option value="">--Select--</option>
    <option>0.0 - 1.0</option>
    <option>1.25 - 2.5</option>
    <option>2.75 - 4.0</option>
    <option>4.25 - 5.0</option>
  </select>
--!>

  <label>Team Majority Sync Sequence Description</label>
  <textarea id="teamSync" rows="4" placeholder="Please note the number of athletes and any ripples.
  
  Example:
  9 roundoff backhandsprings - rippled in 3 groups of 3"></textarea>

  <label>Additional Tumbling Skills Description</label>
  <textarea id="additionalTumbling" rows="9" placeholder="Please list any additional tumbling skills in the order of performance.

Example:
2 cartwheels
3 round offs
1 aerial
4 round off backhandspring tucks
1 roundoff layout
8 forward rolls"></textarea>

<hr>

<div class="center-text">
  <h2>Jump Skills Rubric</h2>
  <p><strong>Click on the rubric image to select skills.</strong></p>
</div>

<div class="wrapper">
    <img id="JumpRubricImage" src="Jump_Rubric.png" alt="Jump Rubric">

    <!-- Highlight boxes (clickable areas) -->
    <!-- Row 1: 0.0 ‚Äì 1.5 -->
    <div class="jumphighlight jump" id="jump1" 
         style="left:10px; top:100px; width:440px; height:70px;" 
         data-value="0.0 ‚Äì 1.5"></div>

    <!-- Row 2: 1.75 ‚Äì 2.75 -->
    <div class="jumphighlight jump" id="jump2" 
         style="left:10px; top:172px; width:440px; height:55px;" 
         data-value="1.75 ‚Äì 2.75"></div>

    <!-- Row 3: 3.00 ‚Äì 4.00 -->
    <div class="jumphighlight jump" id="jump3" 
         style="left:10px; top:231px; width:440px; height:103px;" 
         data-value="3.00 ‚Äì 4.00"></div>

    <!-- Row 4: 4.25 ‚Äì 4.75 -->
    <div class="jumphighlight jump" id="jump4" 
         style="left:10px; top:338px; width:440px; height:41px;" 
         data-value="4.25 ‚Äì 4.75"></div>

    <!-- Row 5: 5.0 -->
    <div class="jumphighlight jump" id="jump5" 
         style="left:10px; top:383px; width:440px; height:55px;" 
         data-value="5.0"></div>
</div>

<div id="JumpOutput" style="margin-top:15px; font-size:1.2em; font-weight:bold;">
    Jump Difficulty Range: None
</div>

<!--
  <label>Intended Jump Range</label>
  <select id="jumpRange">
    <option value="">--Select--</option>
    <option>0.0 - 1.5</option>
    <option>1.75 - 2.75</option>
    <option>3.0 - 4.0</option>
    <option>4.25 - 4.75</option>
    <option>5.0</option>
  </select>
--!>

  <label>Jump Sequence Description</label>
  <textarea id="jumpSequence" rows="5" placeholder="Please describe your jump sequence in detail.

Example:
11 right hurdlers (in cheer)
11 double toe touches"></textarea>

<hr>

  <label>Any Legality Rulings from Bill Ahern?</label>
  <select id="legalityRulings">
    <option value="">--Select--</option>
    <option>Yes</option>
    <option>No</option>
  </select>


  <div style="text-align: center; margin-top: 30px;">
    <button type="button" id="saveBtn" style="padding: 12px 20px; font-size: 16px;">Save & Submit</button>
  </div>


<!-- Summary Output Results -->

<div id="SummaryWrapper" style="display:none;">
<label>Stunt Skills Summary</label>
<div id="StuntSkills" style="white-space: pre-wrap; background: #f0f0f0; padding: 8px; border-radius: 4px;"></div>

<label>Overall Stunt Difficulty Range</label>
<div id="StuntRange" style="background: #f0f0f0; padding: 8px; border-radius: 4px;"></div>

<label>Pyramid Skills Summary</label>
<div id="PyramidSkills" style="white-space: pre-wrap; background: #f0f0f0; padding: 8px; border-radius: 4px;"></div>

<label>Overall Pyramid Difficulty Range</label>
<div id="PyramidRange" style="background: #f0f0f0; padding: 8px; border-radius: 4px;"></div>
</div>




<!-- ========================END HTML VISUAL======================== -->

<script src="https://cdn.jsdelivr.net/npm/sortablejs@1.17.0/Sortable.min.js"></script>

<script>

// Fetch events from Apps Script
fetch('https://script.google.com/macros/s/AKfycbw8DIaXoRRl2UaQLSuc4U1_bniKOcXc-Clu2oWwVxJo5qreetItn3wXthTyWCC3kz0K')
  .then(res => res.json())
  .then(events => {
    const select = document.getElementById('competitionLocation');
    events.forEach((e, index) => {
      const opt = document.createElement('option');
      opt.value = index; // store index temporarily
      opt.textContent = e.display;
      opt.dataset.association = e.association; // hidden association for submission
      select.appendChild(opt);
    });
  })
  .catch(err => console.error('Error fetching events:', err));


//Labels for all stunt & pyramid skills
const StuntRegions = [
  { id: 'i1', skill: 'Connected Inversions - Prep Level and Below to Below Prep', category: 'Inversion', difficulty: 'Beginner'},
  { id: 'i2', skill: 'Below Prep Level Inversions to Ground', category: 'Inversion', difficulty: 'Beginner' },
  { id: 'i3', skill: 'Released Inversion Prep Level or Below to Below Prep', category: 'Inversion', difficulty: 'Beginner' },
  { id: 'i4', skill: 'Connected Inversions - Prep Level and Below to Prep', category: 'Inversion', difficulty: 'Intermediate' },
  { id: 'r1', skill: 'Release to Below Prep', category: 'Release', difficulty: 'Beginner' },
  { id: 'r2', skill: 'Horizontal Releases to Below Prep', category: 'Release', difficulty: 'Beginner' },
  { id: 'r3', skill: 'Extended Release to Below Prep', category: 'Release', difficulty: 'Beginner' },
  { id: 't1', skill: '1/4 or 1/2 Up to Prep Level', category: 'Twisting', difficulty: 'Beginner' },
  { id: 't2', skill: '1/4 Up to Extended', category: 'Twisting', difficulty: 'Beginner' },
  { id: 't3', skill: '1/4 or 1/2 Twisting Transitions', category: 'Twisting', difficulty: 'Beginner' },
  { id: 'c1', skill: 'Single Base at Prep Level', category: 'Coed', difficulty: 'Beginner' },
  { id: 'c2', skill: 'Assisted Coed Skills to Prep', category: 'Coed', difficulty: 'Beginner' },
  { id: 'c3', skill: 'Assisted Walk-In/Toss to Chair', category: 'Coed', difficulty: 'Beginner' },
  { id: 'o1', skill: 'Prep Level and Below Stunts Not Previously Categorized', category: 'Toss', difficulty: 'Beginner' },
  { id: 'o2', skill: 'Straight Ride or Pretty Girl Tosses', category: 'Toss', difficulty: 'Beginner' },
  { id: 'o3', skill: 'Single Skill Tosses', category: 'Toss', difficulty: 'Beginner' },
  { id: 'h1', skill: 'TEST', category: 'Inversion', difficulty: 'Advanced' },
  { id: 'h2', skill: 'TEST', category: 'Release', difficulty: 'Elite' },
  { id: 'h3', skill: 'TEST', category: 'Twisting', difficulty: 'Super Elite' }
];

const PyramidRegions = [
  { id: 'n1', skill: 'Braced Non-Released Transitions', category: 'Inversion', difficulty: 'Beginner' },
  { id: 'n2', skill: 'Inverted Stunts to Prep Level and Below', category: 'Inversion', difficulty: 'Beginner' },
  { id: 'n3', skill: 'Intermediate Twisting Stunt Variations', category: 'Inversion', difficulty: 'Beginner' },
  { id: 'n4', skill: 'Unbraced Non-Released Transitions', category: 'Inversion', difficulty: 'Intermediate' },

  { id: 'pr1', skill: 'Braced Release to Prep or Below (1 or 2)', category: 'Release', difficulty: 'Beginner' },
  { id: 'pr2', skill: 'Braced Release to Extended (2)', category: 'Release', difficulty: 'Beginner' },
  { id: 'pr3', skill: 'Braced Release to Extended (1)', category: 'Release', difficulty: 'Beginner' },
 
  { id: 'b1', skill: 'Rolling Transition to Prep Level or Below', category: 'Twisting', difficulty: 'Advanced' },
  { id: 'b2', skill: 'Flipping Transition Landing Below Prep Level (1 or 2)', category: 'Twisting', difficulty: 'Elite' },
  { id: 'b3', skill: '1/4 Twisting Flipping Transition Landing at Prep or Below (1 or 2)', category: 'Twisting', difficulty: 'Super Elite' },
];

const wrapper = document.querySelector('.wrapper');
const skillCountsContainer = document.getElementById('skillCounts');

const pyramidWrapper = document.querySelector('#PyramidRubricImage').parentElement;
const pyramidCountsContainer = document.getElementById('PyramidCounts');

// CLICK HANDLER FOR STUNT RUBRIC
wrapper.addEventListener('click', e => {
  const rect = wrapper.getBoundingClientRect();
  const x = e.clientX - rect.left;
  const y = e.clientY - rect.top;

  for (let r of StuntRegions) {
    const box = document.getElementById(r.id);
    const left = parseFloat(box.style.left);
    const top = parseFloat(box.style.top);
    const width = parseFloat(box.style.width);
    const height = parseFloat(box.style.height);

    if (x >= left && x <= left + width && y >= top && y <= top + height) {
      const skillId = 'count_' + r.id;

      // Flash highlight when clicked
      box.style.display = "block";
      setTimeout(() => box.style.display = "none", 150);

      // Create new row
      const row = document.createElement('tr');
      row.id = skillId + '_' + Date.now();
      row.draggable = true; // <-- Make row draggable
      row.innerHTML = `
        <td class="drag-handle">‚áÖ</td>
        <td>${r.skill}</td>
		 <td>${r.difficulty}</td>
        <td><input type="number" id="${skillId}" min="0" value="0"></td>
        <td class="delete-btn">üóëÔ∏è</td>
      `;
      skillCountsContainer.appendChild(row);

      // Delete row
      row.querySelector('.delete-btn').addEventListener('click', () => {
        skillCountsContainer.removeChild(row);
      });

      break;
    }
  }
});

// DRAG‚ÄìDROP FOR STUNT TABLE (Desktop + Mobile)
const stuntList = document.getElementById('stuntList');

// Initialize Sortable.js for drag & drop
const sortable = new Sortable(stuntList, {
  animation: 150,
  ghostClass: 'dragging',
  handle: '.drag-handle',
  onEnd: function(evt) {
    updateHighlights(); // Update output/highlights after reordering
  }
});

// Function to dynamically add a stunt row
function addStuntRow(skillName, difficulty, count) {
  const row = document.createElement('div');
  row.className = 'stuntRow';
  row.dataset.skill = skillName;
  row.dataset.difficulty = difficulty;
  row.dataset.count = count;

  // Drag handle
  const handleCell = document.createElement('div');
  handleCell.className = 'cell drag-handle';
  handleCell.textContent = '‚áÖ';

  // Skill cell
  const skillCell = document.createElement('div');
  skillCell.className = 'cell';
  skillCell.textContent = skillName;

  // Difficulty cell
  const difficultyCell = document.createElement('div');
  difficultyCell.className = 'cell';
  difficultyCell.textContent = difficulty;

  // Count cell
  const countCell = document.createElement('div');
  countCell.className = 'cell';
  countCell.textContent = count;

  // Delete button cell
  const deleteCell = document.createElement('div');
  deleteCell.className = 'cell';
  deleteCell.textContent = 'üóëÔ∏è';
  deleteCell.style.cursor = 'pointer';
  deleteCell.onclick = () => {
    row.remove();
    updateHighlights();
  };

  // Append all cells
  row.append(handleCell, skillCell, difficultyCell, countCell, deleteCell);

  // Add row to container
  stuntList.appendChild(row);

  // Update highlights/output immediately
  updateHighlights();
}

// Function to update highlights/output
function updateHighlights() {
  const rows = Array.from(stuntList.children);
  const data = rows.map(row => ({
    skill: row.dataset.skill,
    difficulty: row.dataset.difficulty,
    count: row.dataset.count
  }));
  console.log('Current row order:', data);

  // TODO: integrate your existing highlight/output logic here
}

// ------------------------
// Example: simulate clicking rubric images
addStuntRow('Skill 1', 'Intermediate', 5);
addStuntRow('Skill 2', 'Advanced', 4);
addStuntRow('Skill 3', 'Beginner', 3);




// CLICK HANDLER FOR PYRAMID RUBRIC
pyramidWrapper.addEventListener('click', e => {
  const rect = pyramidWrapper.getBoundingClientRect();
  const x = e.clientX - rect.left;
  const y = e.clientY - rect.top;

  for (let r of PyramidRegions) {
    const box = document.getElementById(r.id);
    const left = parseFloat(box.style.left);
    const top = parseFloat(box.style.top);
    const width = parseFloat(box.style.width);
    const height = parseFloat(box.style.height);

    if (x >= left && x <= left + width && y >= top && y <= top + height) {
      const skillId = 'pcount_' + r.id;

      // Flash highlight when clicked
      box.style.display = "block";
      setTimeout(() => box.style.display = "none", 150);

      // Create new row
      const row = document.createElement('tr');
      row.id = skillId + '_' + Date.now();
      row.draggable = true;
      row.innerHTML = `
        <td class="drag-handle">‚áÖ</td>
        <td>${r.skill}</td>
        <td>${r.difficulty}</td>
        <td><input type="number" id="${skillId}" min="0" value="0"></td>
        <td class="delete-btn">üóëÔ∏è</td>
      `;
      pyramidCountsContainer.appendChild(row);

      // Delete row
      row.querySelector('.delete-btn').addEventListener('click', () => {
        pyramidCountsContainer.removeChild(row);
      });

      break;
    }
  }
});

// DRAG‚ÄìDROP FOR PYRAMID TABLE
let draggedPyramidRow = null;

	pyramidCountsContainer.addEventListener('dragstart', e => {
	draggedPyramidRow = e.target.closest('tr');
	if (draggedPyramidRow) e.dataTransfer.effectAllowed = 'move';
	});

	pyramidCountsContainer.addEventListener('dragover', e => {
	e.preventDefault();
	const targetRow = e.target.closest('tr');
	if (!targetRow || targetRow === draggedPyramidRow) return;
	
	const rect = targetRow.getBoundingClientRect();
	const next = (e.clientY - rect.top) > rect.height / 2;
	pyramidCountsContainer.insertBefore(draggedPyramidRow, next ? targetRow.nextSibling : targetRow);
	});

	pyramidCountsContainer.addEventListener('drop', e => {
	e.preventDefault();
	draggedPyramidRow = null;
	});

// DIFFICULTY CHECKER FOR STUNTS
function runChecker() {
  const numAthletes = parseInt(document.getElementById('numAthletes').value) || 0;
  const majorityStunt = numAthletes <= 15 ? 2 : 3;

  const rows = document.querySelectorAll('#skillCounts tr');
  let majoritySkills = [];
  let outputText = 'Selected Stunt Skills:\n\n';

  // Step 1: Reset table coloring
  rows.forEach((row, idx) => {
    // skip header if (idx === 0) return; 
    row.classList.remove('majority', 'non-majority');
  });

  // Step 2: Label Non-Majority Skills and gather majority skills
  rows.forEach((row, idx) => {
    // skip header if (idx === 0) return; 
    const skill = row.cells[1].textContent;
    const difficulty = row.cells[2].textContent;
    const count = parseInt(row.cells[3].querySelector('input').value) || 0;

    if (count >= majorityStunt) {
      majoritySkills.push({ skill, difficulty });
      row.classList.add('majority');
      outputText += `${count} ‚Äî ${difficulty} ‚Äî ${skill} \n`;
    } else {
      row.classList.add('non-majority');
      outputText += `${count} ‚Äî ${difficulty} ‚Äî ${skill} (Non Majority)\n`;
    }
  });

  // Step 3: Define difficulty levels for sorting
  const difficultyLevels = {
    'Beginner': 1,
    'Intermediate': 2,
    'Advanced': 3,
    'Elite': 4,
    'Super Elite': 5
  };

  // Step 4: Count how many majority skills are at each difficulty
  const difficultyCount = {};
  majoritySkills.forEach(s => {
    difficultyCount[s.difficulty] = (difficultyCount[s.difficulty] || 0) + 1;
  });

  // Step 5: Sort difficulties from highest to lowest
  const sortedDifficulties = Object.keys(difficultyLevels).sort(
    (a, b) => difficultyLevels[b] - difficultyLevels[a]
  );

  // Step 6: Determine overall difficulty based on cumulative majority
  let overallStuntDifficulty = null;
  const startingIndex = sortedDifficulties.findIndex(d => difficultyCount[d] >= 1);

  if (startingIndex !== -1) {
    let cumulative = 0;
    // Step down from highest to lowest, adding cumulative majority skills
    for (let i = startingIndex; i < sortedDifficulties.length; i++) {
      cumulative += (difficultyCount[sortedDifficulties[i]] || 0);
      if (cumulative >= 2) {
        overallStuntDifficulty = sortedDifficulties[i]; // first range that meets cumulative majority
        break;
      }
    }
  }

  // Step 7: Output results
  outputText += `\nRequired Number of Groups for Majority: ${majorityStunt}`;
  outputText += `\nOverall Difficulty Range: ${overallStuntDifficulty || 'Selected skills do not meet rubric requirements for majority'}`;

  document.getElementById('output').textContent = outputText;
  
 // Step 8: Populate Summary 
	let StuntSkillListOutput = '';
		rows.forEach(row => {
    const skill = row.cells[1].textContent;
    const difficulty = row.cells[2].textContent;
    const count = parseInt(row.cells[3].querySelector('input').value) || 0;
    StuntSkillListOutput += `${count} ‚Äî ${difficulty} ‚Äî ${skill} `;
    if (!row.classList.contains('majority')) StuntSkillListOutput += ' (Non Majority)';
    StuntSkillListOutput += '\n';
});
	document.getElementById('StuntSkills').textContent = StuntSkillListOutput;
	document.getElementById('StuntRange').textContent = overallStuntDifficulty || 'Rubric Requirements Not Met';
	
}


// DIFFICULTY CHECKER FOR PYRAMID
function runChecker2() {
  const numAthletes = parseInt(document.getElementById('numAthletes').value) || 0;
  const majorityPyramid = numAthletes <= 15 ? 2 : 3;

  const rows = document.querySelectorAll('#PyramidCounts tr');
  let majoritySkills = [];
  let outputText = 'Selected Pyramid Skills:\n\n';

  // Step 1: Reset table coloring
  rows.forEach(row => row.classList.remove('majority', 'non-majority'));

  // Step 2: Label Non-Majority Skills and gather majority skills
  rows.forEach(row => {
    const skill = row.cells[1].textContent;
    const difficulty = row.cells[2].textContent;
    const count = parseInt(row.cells[3].querySelector('input').value) || 0;

    if (count >= majorityPyramid) {
      majoritySkills.push({ skill, difficulty });
      row.classList.add('majority');
      outputText += `${count} ‚Äî ${difficulty} ‚Äî ${skill}\n`;
    } else {
      row.classList.add('non-majority');
      outputText += `${count} ‚Äî ${difficulty} ‚Äî ${skill} (Non Majority)\n`;
    }
  });

 // Step 3: Define difficulty levels for sorting
  const difficultyLevels = {
    'Beginner': 1,
    'Intermediate': 2,
    'Advanced': 3,
    'Elite': 4,
    'Super Elite': 5
  };

  // Step 4: Count how many majority skills are at each difficulty
  const difficultyCount = {};
  majoritySkills.forEach(s => {
    difficultyCount[s.difficulty] = (difficultyCount[s.difficulty] || 0) + 1;
  });

  // Step 5: Sort difficulties from highest to lowest
  const sortedDifficulties = Object.keys(difficultyLevels).sort(
    (a, b) => difficultyLevels[b] - difficultyLevels[a]
  );

  // Step 6: Determine overall difficulty based on cumulative majority
  let overallPyramidDifficulty = null;
  const startingIndex = sortedDifficulties.findIndex(d => difficultyCount[d] >= 1);

  if (startingIndex !== -1) {
    let cumulative = 0;
    for (let i = startingIndex; i < sortedDifficulties.length; i++) {
      cumulative += (difficultyCount[sortedDifficulties[i]] || 0);
      if (cumulative >= 3) {
        overallPyramidDifficulty = sortedDifficulties[i];
        break;
      }
    }
  }

  // Step 7: Output results
  outputText += `\nRequired Number of Trick Flyers for Majority: ${majorityPyramid}`;
  outputText += `\nOverall Difficulty Range: ${overallPyramidDifficulty || 'Selected skills do not meet rubric requirements for majority'}`;

  document.getElementById('outputp').textContent = outputText;

 // Step 8: Populate Summary 
  let PyramidSkillListOutput = '';
  rows.forEach(row => {
    const skill = row.cells[1].textContent;
    const difficulty = row.cells[2].textContent;
    const count = parseInt(row.cells[3].querySelector('input').value) || 0;

    PyramidSkillListOutput += `${count} ‚Äî ${difficulty} ‚Äî ${skill}`;
    if (!row.classList.contains('majority')) PyramidSkillListOutput += ' (Non Majority)';
    PyramidSkillListOutput += '\n';
  });

  document.getElementById('PyramidSkills').textContent = PyramidSkillListOutput;
  document.getElementById('PyramidRange').textContent = overallPyramidDifficulty || 'Rubric Requirements Not Met';
}



//================== Tumbling Selection ==================
document.querySelectorAll('.tumblinghighlight.tumbling').forEach(box => {
    box.addEventListener('click', () => {
        document.querySelectorAll('.tumblinghighlight.tumbling').forEach(b => b.classList.remove('selected'));
        box.classList.add('selected');

        const output = document.getElementById('TumblingOutput');
        const value = box.dataset.value || "";
        output.dataset.selected = value; // store selected value for validation
        output.innerText = value ? `Tumbling Difficulty Range: ${value}` : "";
    });
});

//================== Jump Selection ==================
document.querySelectorAll('.jumphighlight.jump').forEach(box => {
    box.addEventListener('click', () => {
        document.querySelectorAll('.jumphighlight.jump').forEach(b => b.classList.remove('selected'));
        box.classList.add('selected');

        const output = document.getElementById('JumpOutput');
        const value = box.dataset.value || "";
        output.dataset.selected = value; // store selected value for validation
        output.innerText = value ? `Jump Difficulty Range: ${value}` : "";
    });
});


// CHECK FOR ALL FIELDS TO BE POPULATED & OUTPUT ERROR MESSAGE FOR ANY MISSING

//================== Custom Alert ==================
function showCustomAlert(message) {
    const alertDiv = document.getElementById('customAlert');
    document.getElementById('customAlertText').textContent = message;
    alertDiv.style.display = 'flex';
    document.getElementById('customAlertOk').onclick = () => { alertDiv.style.display = 'none'; };
}

//================== Save & Submit Handler ==================
document.getElementById("saveBtn").addEventListener("click", () => {

    // Run the difficulty checkers first
    runChecker();
    runChecker2();

    // Define required fields
    const requiredFields = [
        { id: 'schoolName', label: 'School Name' },
        { id: 'teamLevel', label: 'Team Level' },
        { id: 'CoachName', label: 'Head Coach Name' },
        { id: 'CoachEmail', label: 'Head Coach Email' },
        { id: 'numAthletes', label: 'Number of Athletes Performing' },
        { id: 'competitionLocation', label: 'Competition Location' },
        { id: 'competitionDate', label: 'Competition Date' },
        { id: 'StuntSkills', label: 'Stunt Skills' },
        { id: 'PyramidSkills', label: 'Pyramid Skills' },
        { id: 'TumblingOutput', label: 'Tumbling Difficulty Range' },
        { id: 'teamSync', label: 'Team Majority Sync Sequence Description' },
        { id: 'additionalTumbling', label: 'Additional Tumbling Skills Description' },
        { id: 'JumpOutput', label: 'Jump Difficulty Range' },
        { id: 'jumpSequence', label: 'Jump Sequence Description' },
        { id: 'legalityRulings', label: 'Any Legality Rulings from Bill Ahern?' }
    ];

    let missingFields = [];

	//Validation of missing fields
		requiredFields.forEach(f => {
		const field = document.getElementById(f.id);
		if (!field) return;

		field.style.border = ""; // reset border
		let fieldValue = "";

    // Standard input/textarea/select
		if (field.tagName === "INPUT" || field.tagName === "TEXTAREA" || field.tagName === "SELECT") {
        fieldValue = field.value.trim();}
    
	// Tumbling/Jump output divs
		else if (f.id === "TumblingOutput" || f.id === "JumpOutput") {
   
		// Use dataset.selected if it exists, otherwise check innerText after the colon
		fieldValue = field.dataset.selected || "";	}

    // Stunt/Pyramid tables
    else if (f.id === "StuntSkills" || f.id === "PyramidSkills") {
        const tableId = f.id === "StuntSkills" ? "#skillCounts" : "#PyramidCounts";
        const rows = document.querySelectorAll(tableId + " tr");
        const hasCount = Array.from(rows).some(row => {
            const input = row.querySelector('input');
            return input && parseInt(input.value, 10) > 0;   });
        fieldValue = hasCount ? "filled" : ""; }
    
	// Any Other <div> options
    else {fieldValue = field.textContent.trim(); }

    if (!fieldValue) {
        missingFields.push(f.label);
        field.style.border = "2px solid red";}
});


    if (missingFields.length > 0) {
        showCustomAlert(
            "All fields are required before submission. Please fill out the missing fields:\n\n" +
            missingFields.join("\n")
        );

        // Focus the first missing field
        const firstMissing = requiredFields.find(f => missingFields.includes(f.label));
        if (firstMissing) document.getElementById(firstMissing.id).focus();

        return; // stop submission if anything is missing
    }

    // Everything is filled ‚Äî add submission logic here
    console.log("All fields validated. Ready to submit!");
});
 // Optional: continue with actual save/submit logic here


</script>

<!-- ========================ERROR ALERT MESSAGE======================== -->

<div id="customAlert" style="display:none;">
  <div id="customAlertContent">
    <p id="customAlertText"></p>
    <button id="customAlertOk">OK</button>
  </div>
</div>

</body>
</html>




